<!DOCTYPE html>
<html lang="th" data-theme="studio-blue">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#1a202c" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Mobile RTA (Pro)</title>
  <style>
    /* --- Theme: Dark Matter --- */
    :root, [data-theme="dark-matter"]{
      --bg1:#1a202c; --bg2:#1a202c; --card:#2d3748; --text:#cbd5e1; --muted:#718096;
      --gridH:rgba(255,255,255,.08); --gridV:rgba(255,255,255,.04);
      --frame:rgba(255,255,255,.1); --label:rgba(255,255,255,.85);
      --fft:#68d391; --peak:#b794f4; --hold:#f6ad55; --bar:#68d391;
      --heatmap-color-1:#1a202c; --heatmap-color-2:#4a5568; --heatmap-color-3:#68d391;
      --heatmap-color-4:#f6ad55; --heatmap-color-5:#e53e3e;
      --dba-meter-bg-green:#48bb78; --dba-meter-bg-yellow:#f6ad55;
      --dba-meter-bg-orange:#ed8936; --dba-meter-bg-red:#e53e3e;
      --accent-color:#2DD4BF;

      /* dropdown tones */
      --select-bg:rgba(0,0,0,.28);
      --select-bg-hover:rgba(255,255,255,.08);
      --select-border:rgba(255,255,255,.14);
      --select-text:#e5e7eb;
      --select-menu-bg:#1f2937;
      --select-menu-border:rgba(255,255,255,.12);
      --select-menu-item:#e5e7eb;
      --select-menu-item-active:#93c5fd;
    }

    /* --- Theme: Studio Blue (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô) --- */
    [data-theme="studio-blue"]{
      --bg1:#0F172A; --bg2:#1E293B; --card:#1E293B; --text:#E2E8F0; --muted:#64748B;
      --gridH:rgba(255,255,255,.1); --gridV:rgba(255,255,255,.05);
      --frame:rgba(255,255,255,.12); --label:rgba(255,255,255,.9);
      --fft:#22D3EE; --peak:#A5B4FC; --hold:#F472B6; --bar:#22D3EE;
      --heatmap-color-1:#0F172A; --heatmap-color-2:#334155; --heatmap-color-3:#0EA5E9;
      --heatmap-color-4:#A78BFA; --heatmap-color-5:#F472B6;
      --dba-meter-bg-green:#22D3EE; --dba-meter-bg-yellow:#A78BFA;
      --dba-meter-bg-orange:#EC4899; --dba-meter-bg-red:#F43F5E;
      --accent-color:#60A5FA;

      --select-bg:rgba(148,163,184,.18);
      --select-bg-hover:rgba(148,163,184,.28);
      --select-border:rgba(148,163,184,.35);
      --select-text:#E2E8F0;
      --select-menu-bg:#0f172a;
      --select-menu-border:rgba(148,163,184,.3);
      --select-menu-item:#E2E8F0;
      --select-menu-item-active:#60A5FA;
    }

    /* --- Theme: Vintage Amber --- */
    [data-theme="vintage-amber"]{
      --bg1:#292524; --bg2:#1c1917; --card:#44403C; --text:#D6D3D1; --muted:#A8A29E;
      --gridH:rgba(255,250,235,.10); --gridV:rgba(255,250,235,.05);
      --frame:rgba(255,250,235,.12); --label:rgba(255,255,255,.9);
      --fft:#F59E0B; --peak:#FDE68A; --hold:#FDBA74; --bar:#F59E0B;
      --heatmap-color-1:#292524; --heatmap-color-2:#78716C; --heatmap-color-3:#F59E0B;
      --heatmap-color-4:#FBBF24; --heatmap-color-5:#EF4444;
      --dba-meter-bg-green:#F59E0B; --dba-meter-bg-yellow:#FACC15;
      --dba-meter-bg-orange:#FB923C; --dba-meter-bg-red:#EF4444;
      --accent-color:#D97706;

      --select-bg:rgba(245,158,11,.15);
      --select-bg-hover:rgba(245,158,11,.25);
      --select-border:rgba(245,158,11,.35);
      --select-text:#FDE68A;
      --select-menu-bg:#1c1917;
      --select-menu-border:rgba(245,158,11,.28);
      --select-menu-item:#FDE68A;
      --select-menu-item-active:#F59E0B;
    }

    :root{ color-scheme:dark }
    html{ background:var(--bg1) }
    body{
      margin:0; height:100%;
      background:radial-gradient(1200px 600px at 70% -10%, var(--card) 10%, var(--bg1) 60%, var(--bg2) 100%);
      color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans Thai",sans-serif;
      -webkit-touch-callout:none; -webkit-user-select:none; user-select:none; overscroll-behavior:contain;
      transition: background .3s, color .3s;
    }

    .wrap{display:flex;flex-direction:column;gap:12px;max-width:1120px;margin:0 auto;
      padding:12px; padding-left:calc(12px + env(safe-area-inset-left)); padding-right:calc(12px + env(safe-area-inset-right));
      padding-top:calc(12px + env(safe-area-inset-top)); padding-bottom:calc(12px + env(safe-area-inset-bottom));
    }
    .row{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.1);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.25);padding:12px}
    .badges{display:flex;gap:6px;align-items:center}
    .badge{padding:4px 8px;border-radius:999px;background:rgba(0,0,0,.45);border:1px solid rgba(255,255,255,.12);font-size:12px;color:#e5e7eb;white-space:nowrap}

    /* Themed selects */
    select{
      appearance:none; -webkit-appearance:none; -moz-appearance:none;
      background:var(--select-bg);
      border:1px solid var(--select-border);
      color:var(--select-text);
      border-radius:10px;
      height:28px;
      padding:0 24px 0 8px;
      font-size:13px;
      outline:none;
      transition:background .15s,border-color .15s;
    }
    select:hover{ background:var(--select-bg-hover); }
    select:focus{ box-shadow:0 0 0 2px rgba(255,255,255,.06) inset; }

    /* compact dropdowns for tight spots */
    .select-tight{ height:28px; padding:0 12px 0 8px; font-size:12px; min-width:auto; }

    /* fake chevron */
    .select-wrap{ position:relative; display:inline-flex; align-items:center; }
    .select-wrap:after{
      content:""; position:absolute; right:8px; width:0; height:0; pointer-events:none;
      border-left:4px solid transparent; border-right:4px solid transparent; border-top:6px solid var(--select-text);
    }

    .meters{display:grid;grid-template-columns:1fr;gap:12px}
    canvas{width:100%;height:320px;background:var(--bg1);border-radius:12px;touch-action:none; display:block}
    .plot{position:relative; height: 320px; margin-top: 8px;}

    /* floating rail */
    .fab-rail{ position:fixed; left:12px; top:calc(50% - 120px); z-index:8; display:flex; flex-direction:column; gap:10px; }
    .fab{ width:40px; height:40px; border-radius:12px; display:grid; place-items:center; border:1px solid rgba(255,255,255,.12); background:rgba(0,0,0,.28); color:var(--text); }
    .fab.active{ background:var(--accent-color); color:#0b1220; }

    /* fullscreen icon ‚õ∂ */
    .fs-btn{ width:34px;height:34px;border-radius:10px;display:grid;place-items:center;background:rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.12);cursor:pointer }
    .card-head{ display:flex; align-items:center; justify-content:space-between; gap:8px }
    .card-right{ display:flex; align-items:center; gap:8px }

    /* corner controls alignment */
    .ctrl-row{ display:flex; align-items:center; gap:8px }

    /* menu (native) color */
    ::-webkit-scrollbar{ width:10px; height:10px }
    ::-webkit-scrollbar-thumb{ background:rgba(255,255,255,.15); border-radius:8px }

  </style>
</head>
<body>
  <div class="wrap">

    <!-- Floating action rail -->
    <div id="rail" class="fab-rail" aria-label="Floating controls">
      <button id="btnStart" class="fab" title="‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏î ‚ñ∂Ô∏è">‚ñ∂Ô∏è</button>
      <button id="btnStop" class="fab" title="‡∏´‡∏¢‡∏∏‡∏î ‚è∏Ô∏è">‚è∏Ô∏è</button>
      <button id="btnHold" class="fab active" title="Hold Peak üìå">üìå</button>
      <button id="btnClear" class="fab" title="Clear ‚ôªÔ∏è">‚ôªÔ∏è</button>
      <button id="btnAWeight" class="fab" title="A-weighting üëÇ">üëÇ</button>
    </div>

    <!-- Header -->
    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:center;">
        <h2 style="margin:0">my RTAs (v 1.5)</h2>
        <div class="row">
          <label>Theme
            <select id="themeSelector">
              <option value="studio-blue" selected>Studio Blue</option>
              <option value="dark-matter">Dark Matter</option>
              <option value="vintage-amber">Vintage Amber</option>
            </select>
          </label>
        </div>
      </div>
    </div>

    <!-- FFT card -->
    <div class="card" id="fftCard">
      <div class="card-head">
        <div class="badges">
          <span class="badge" id="fftPeakText">Peak: ‚Äî</span>
          <span class="badge" id="fftHoldText" style="display:none;">Hold: ‚Äî</span>
        </div>
        <div class="card-right">
          <div class="select-wrap">
            <select id="fftYScale" class="select-tight">
              <option value="log" selected>Log</option>
              <option value="lin">Linear</option>
            </select>
          </div>
          <div class="ctrl-row" aria-label="FFT size">
            <span class="hint" style="opacity:.8">FFT Size</span>
            <input id="fftRangeSlider" type="range" min="0" max="3" step="1" value="1" />
            <div class="select-wrap">
              <select id="fftSizePreset">
                <option value="2048">2048</option>
                <option value="4096" selected>4096</option>
                <option value="8192">8192</option>
                <option value="16384">16384</option>
              </select>
            </div>
            <button class="fs-btn" data-fs="fft">‚õ∂</button>
          </div>
        </div>
      </div>
      <div class="plot">
        <canvas id="fftCanvas"></canvas>
      </div>
    </div>

    <!-- Octave card -->
    <div class="card" id="octCard">
      <div class="card-head">
        <div class="badges">
          <span class="badge" id="octPeakText">Peak: ‚Äî</span>
          <span class="badge" id="octHoldText" style="display:none;">Hold: ‚Äî</span>
        </div>
        <div class="card-right">
          <div class="select-wrap">
            <select id="octRes" class="select-tight">
              <option value="3">1/3</option>
              <option value="6">1/6</option>
              <option value="12" selected>1/12</option>
            </select>
          </div>
          <div class="ctrl-row" aria-label="Octave range">
            <span class="hint" style="opacity:.8">Range</span>
            <input id="octRangeSlider" type="range" min="64" max="1023" step="1" value="255" />
            <div class="select-wrap">
              <select id="octRangePreset">
                <option value="127">127</option>
                <option value="255" selected>256</option>
                <option value="511">512</option>
              </select>
            </div>
            <button class="fs-btn" data-fs="oct">‚õ∂</button>
          </div>
        </div>
      </div>
      <div class="plot">
        <canvas id="octCanvas"></canvas>
      </div>
    </div>

    <!-- Heatmap card -->
    <div class="card" id="heatCard">
      <div class="card-head">
        <div class="badges">
          <span class="badge" id="heatmapAthText">ATH: ‚Äî</span>
        </div>
        <div class="card-right">
          <div class="ctrl-row" aria-label="Heatmap range">
            <span class="hint" style="opacity:.8">Range</span>
            <input id="heatmapRangeSlider" type="range" min="5" max="100" step="5" value="50" />
            <div class="select-wrap">
              <select id="heatmapRangePreset">
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="20">20</option>
                <option value="40">40</option>
                <option value="50" selected>50</option>
                <option value="60">60</option>
                <option value="80">80</option>
                <option value="100">100</option>
              </select>
            </div>
            <button class="fs-btn" data-fs="heat">‚õ∂</button>
          </div>
        </div>
      </div>
      <div class="plot">
        <canvas id="heatmapCanvas"></canvas>
      </div>
    </div>

  </div>

  <script>
  (()=>{

    const $ = (id)=>document.getElementById(id);

    /* theme */
    $('themeSelector').addEventListener('change', (e)=>{
      document.documentElement.dataset.theme = e.target.value;
    });

    /* Fullscreen helpers */
    const fsBtnMap = {
      fft: $('fftCard'),
      oct: $('octCard'),
      heat: $('heatCard'),
    };
    document.querySelectorAll('.fs-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const key = btn.dataset.fs;
        const el = fsBtnMap[key];
        if (!document.fullscreenElement){
          el.requestFullscreen?.();
        }else{
          document.exitFullscreen?.();
        }
      });
    });

    /* make floating rail follow fullscreen on desktop/tablet too */
    const rail = $('rail');
    document.addEventListener('fullscreenchange', ()=>{
      const host = document.fullscreenElement;
      if (host){
        host.style.position = 'relative';
        rail.style.position = 'absolute';
        rail.style.left = '12px';
        rail.style.top = '12px';
        host.appendChild(rail);
      }else{
        rail.style.position = 'fixed';
        rail.style.left = '12px';
        rail.style.top = 'calc(50% - 120px)';
        document.body.appendChild(rail);
      }
    });

    /* Dummy drawing just to keep canvas frames visible for layout testing */
    const canvases = [
      $('fftCanvas'),
      $('octCanvas'),
      $('heatmapCanvas'),
    ];
    const drawBG = (c)=>{
      const ctx=c.getContext('2d');
      const DPR=window.devicePixelRatio||1;
      const rect=c.getBoundingClientRect();
      c.width=rect.width*DPR; c.height=rect.height*DPR;
      ctx.scale(DPR,DPR);
      ctx.clearRect(0,0,rect.width,rect.height);
      ctx.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue('--gridH');
      const pad=18, plotH=rect.height-40;
      for(let i=0;i<5;i++){
        const y=pad+(i/4)*plotH; ctx.beginPath(); ctx.moveTo(12,y); ctx.lineTo(rect.width-12,y); ctx.stroke();
      }
      ctx.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue('--fft');
      ctx.beginPath(); ctx.moveTo(20,rect.height-60);
      for(let x=20;x<rect.width-20;x+=10){ ctx.lineTo(x, rect.height-60 - 20*Math.sin(x*0.02));}
      ctx.stroke();
    };
    const resizeAll=()=>canvases.forEach(drawBG);
    window.addEventListener('resize', resizeAll, {passive:true});
    resizeAll();

    /* floating buttons - demo only */
    const toggle = (btn)=>btn.classList.toggle('active');
    $('btnHold').addEventListener('click', ()=>toggle($('btnHold')));
    $('btnAWeight').addEventListener('click', ()=>toggle($('btnAWeight')));

  })();
  </script>
</body>
</html>
